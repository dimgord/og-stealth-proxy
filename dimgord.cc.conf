upstream og_backend { server 127.0.0.1:3000; keepalive 64; }

# HTTP server block - ONLY for redirect
server {
    listen 80;
    listen [::]:80;
    server_name dimgord.cc www.dimgord.cc;
    
    # Force redirect to HTTPS - no exceptions
    return 301 https://$host$request_uri;
}

# HTTPS server block
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name dimgord.cc www.dimgord.cc;
    
    # Your actual certificate paths
    ssl_certificate /etc/nginx/ssl/certs/dimgord.cc.crt;
    ssl_certificate_key /etc/nginx/ssl/private/dimgord.cc.key;
    
    location /og-proxy {
        proxy_pass http://og_backend/og-proxy;
        include /etc/nginx/snippets/og-common.conf;

	proxy_connect_timeout   5s;
        proxy_send_timeout     10s;
        proxy_read_timeout     10s;
    }

    location /resolve {
        proxy_pass http://og_backend/resolve;
        include /etc/nginx/snippets/og-common.conf;

	proxy_connect_timeout   5s;
        proxy_send_timeout     10s;
        proxy_read_timeout     10s;
    }

    location /can-embed-fb {
        proxy_pass http://og_backend/can-embed-fb;
        include /etc/nginx/snippets/og-common.conf;

	proxy_connect_timeout   5s;
        proxy_send_timeout     10s;
        proxy_read_timeout     10s;
    }

    
    if ($is_bad_bot) {
       return 403;
    } 

    # Root directory - as per your configuration
    root /var/www/dimgord.cc;
    index index.html index.htm index.php;
    
    # Your other configuration directives...
}
